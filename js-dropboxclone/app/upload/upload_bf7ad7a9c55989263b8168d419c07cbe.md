# Drobpbox Clone JS - Recursos Utilizados

## Criando Projeto com Express Generator

Via terminal ou console acessamos a pasta do projeto e dentro dela executamos o comando *express --ejs app* para criar a estrutura do clien-server com express-generator.

Após criado a estrutura, acessamos a pasta app criada e instalamos suas dependencias via 'npm install' e jogamos a estrutura do front (arquivos e pastas estaticas) na pasta public e o index.html jogamos na pasta views e renomeamos para *index.ejs*. A estrutura está pronta para rodar, basta dar o comando *node ./bin/www* para rodar a aplicação na porta 3000 (por default).

## Criando Controller e Evento Click no botão ENVIAR ARQUIVOS

Na pasta public do app criamos uma pasta src e dentro dela um arquivo index.js onde instanciaremos o controller, que será criado dentro de uma pasta controller.

```js
class DropboxController() {
    constructor(){
        this.btnSendFileEl // faz referencia ao botão que terá a ação de clik que fará o change do inputFileEl
        this.inputFilesEl  // faz referencia ao input do tipo file
        this.snackModalEl  // faz referencia ao snackbar que mostra o progresso do arquivo selecionado no inputFilesEl
        this.initEvents(); // método que inicia os eventos de click do btnSendFileEL e do change do inputFilesEl
    }
}
```

```js
// instanciando o controller na app
window.app = new DropboxController();
```

no index.ejs chamamos esses arquivos para que possamos usar na aplicação.


## Enviando files via AJAX e Promise.all()

Podemos usar o recurso de **Promise.all()**, onde ele cria uma Promise que é resolvida com um array de resultados quando todas as Promises do array forem resolvidas ou rejeitadas no caso de alguma Promise der erro. Ela recebe por parametro um array de Promises e por fim retorna uma Promise.

```js
let promises = [];

[...files].forEach(file=>{
    promises.push(new Promise((res, rej)=>{
        // faz o resolve e o reject de cada Promise
    }));
});

return Promise.all(promises); // retorna uma promise do array de promises resolvidas ou não
```

Como no caso da aplicação usamos via AJAX o método POST, precisamos enviar body contendo o arquivo que está sendo selecionado no input. Uma forma de construir esse corpo é usando um recurso da API Web chamado **FormData**.

Ele é uma maneira fácil de construir um objeto com um conjunto de chave/valor representando os campos de um form e seus valores que poderão ser enviados via método *XMLHttpRequest.send()*. O tipo de formatação que ele usa é *multipart/form-data*.

**Formdata.append** = método que acrescenta um novo valor em uma chave existente dentro de um objeto FormData, ou adiciona a chave se ela ainda não existir.

```js
let formData = new FormData();
formData.append('input-file', file); // cria uma chamve input-file e seu valor é o arquivo recebido
ajax.send(formData); // envio do objeto FormData via ajax (XMLHttpRequest.send())
```

## Recebendo files no Node.JS com Formidable

Temos o body-parser no Node.JS que podemos usar para tratar o corpo de uma solicitação POST ou qualquer outra solicitação que receba dados em um body. Entretando, no caso de upload de arquivos o body-parser não é tão efetivo, mas temos uma dependência/extensão muito interessante que é o **Formidable** que especificamente é um módulo para parsear dados de formulário, especificamente upload de arquivos.

Para instalar o mesmo usamos o *npm install --save formidable*.